<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Color Palette Creator - K-Means Game</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 0; }
.nav-header { background: #2d3748; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; justify-content: space-between; align-items: center; }
.nav-header a { color: #90cdf4; text-decoration: none; font-weight: 600; font-size: 1.1em; }
.nav-title { color: #fff; font-size: 1.2em; font-weight: 700; }
.container { max-width: 1400px; margin: 20px auto; background: #fff; border-radius: 15px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
h1 { text-align: center; color: #2d3748; font-size: 2.5em; margin-bottom: 10px; }
.subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1em; }
.game-area { display: grid; grid-template-columns: 350px 1fr; gap: 30px; }
.sidebar { background: #f8f9fa; padding: 20px; border-radius: 10px; height: fit-content; }
button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; }
.btn-primary { background: #4CAF50; color: #fff; }
.btn-secondary { background: #2196F3; color: #fff; }
.btn-danger { background: #f44336; color: #fff; }
.image-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
.image-box { border: 2px solid #ddd; border-radius: 10px; overflow: hidden; }
.image-box h3 { background: #f8f9fa; padding: 10px; text-align: center; color: #2d3748; }
.image-box canvas { width: 100%; display: block; }
.palette-display { display: flex; gap: 10px; margin: 20px 0; flex-wrap: wrap; }
.color-swatch { width: 60px; height: 60px; border-radius: 8px; border: 2px solid #ddd; position: relative; cursor: pointer; transition: all 0.2s; }
.color-swatch:hover { transform: scale(1.1); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
.color-label { font-size: 0.7em; text-align: center; margin-top: 3px; font-weight: 600; }
.stats { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 15px; border-radius: 10px; margin-top: 15px; }
.stat-row { display: flex; justify-content: space-between; margin: 8px 0; }
.control-group { margin: 15px 0; }
.control-group label { display: block; margin-bottom: 8px; font-weight: 600; }
.control-group input[type="range"] { width: 100%; }
.control-group .value { float: right; color: #667eea; }
.image-selector { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin: 15px 0; }
.image-btn { padding: 10px; border: 2px solid #667eea; background: #fff; color: #667eea; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; text-align: center; }
.image-btn:hover { background: #667eea; color: #fff; }
.image-btn.active { background: #667eea; color: #fff; }
.score-display { background: #fff9c4; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; border: 2px solid #fbc02d; }
.score-value { font-size: 2.5em; font-weight: bold; color: #667eea; margin: 10px 0; }
.challenge { background: #e8f5e9; padding: 15px; border-radius: 10px; margin: 15px 0; border-left: 4px solid #4CAF50; }
.challenge h4 { color: #2e7d32; margin-bottom: 8px; }
.info-panel { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; }
.info-panel h4 { color: #1976d2; margin-bottom: 8px; }
</style>
</head>
<body>
<nav class="nav-header">
    <div class="nav-title">üé® Color Palette Creator</div>
    <a href="../../index.html">‚Üê Back to Home</a>
</nav>
<div class="container">
    <h1>üé® Color Palette Creator</h1>
    <p class="subtitle">Use K-Means clustering to compress image colors!</p>

    <div class="game-area">
        <div class="sidebar">
            <h3>üéÆ Controls</h3>

            <div class="image-selector">
                <button class="image-btn active" onclick="selectImage('sunset')">üåÖ Sunset</button>
                <button class="image-btn" onclick="selectImage('forest')">üå≤ Forest</button>
                <button class="image-btn" onclick="selectImage('ocean')">üåä Ocean</button>
                <button class="image-btn" onclick="selectImage('flower')">üå∏ Flower</button>
            </div>

            <div class="control-group">
                <label>Colors (K): <span class="value" id="kValue">8</span></label>
                <input type="range" min="2" max="16" value="8" id="kSlider" onchange="updateK()">
            </div>

            <button class="btn-primary" onclick="compress()">üé® Compress Colors</button>
            <button class="btn-secondary" onclick="downloadPalette()">üíæ Save Palette</button>
            <button class="btn-danger" onclick="reset()">üîÑ Reset</button>

            <div class="challenge">
                <h4>üèÜ Challenge:</h4>
                <p style="font-size: 0.9em; line-height: 1.6;">
                    Find the minimum K that keeps the image recognizable!
                    <br><br>
                    <strong>Target:</strong> < 10 colors, Quality > 80%
                </p>
            </div>

            <div class="stats">
                <div class="stat-row"><span>Original Colors:</span><span id="originalColors">0</span></div>
                <div class="stat-row"><span>Compressed Colors:</span><span id="compressedColors">0</span></div>
                <div class="stat-row"><span>Compression:</span><span id="compression">0%</span></div>
                <div class="stat-row"><span>Quality Score:</span><span id="quality">0%</span></div>
            </div>

            <div class="info-panel">
                <h4>üí° How K-Means Works:</h4>
                <p style="font-size: 0.9em; line-height: 1.6;">
                    1. Pick K random colors (centroids)<br>
                    2. Assign each pixel to nearest centroid<br>
                    3. Update centroids to cluster average<br>
                    4. Repeat until converged<br><br>
                    Result: Image uses only K colors!
                </p>
            </div>
        </div>

        <div>
            <div class="score-display">
                <h3>Compression Score</h3>
                <div class="score-value" id="scoreValue">0</div>
                <p style="color: #666;">Balance compression ratio vs image quality</p>
            </div>

            <div class="image-comparison">
                <div class="image-box">
                    <h3>Original Image</h3>
                    <canvas id="originalCanvas" width="400" height="300"></canvas>
                </div>
                <div class="image-box">
                    <h3>Compressed (K-Means)</h3>
                    <canvas id="compressedCanvas" width="400" height="300"></canvas>
                </div>
            </div>

            <h3 style="margin: 20px 0;">Color Palette:</h3>
            <div class="palette-display" id="paletteDisplay">
                <p style="color: #999; width: 100%; text-align: center;">Compress an image to see the color palette!</p>
            </div>

            <div style="background: #fff3e0; padding: 20px; border-radius: 10px; margin-top: 20px; border-left: 4px solid #ff9800;">
                <h4 style="color: #e65100; margin-bottom: 10px;">üìö Real-World Applications</h4>
                <p style="line-height: 1.6;">
                    K-Means color quantization is used in:
                    <strong>GIF compression</strong> (limited to 256 colors),
                    <strong>image optimization</strong> for web (reduce file size),
                    <strong>color palette extraction</strong> for design,
                    and <strong>image segmentation</strong> in computer vision.
                    By reducing the number of colors, we can dramatically reduce file sizes while
                    maintaining visual quality - perfect for faster web loading times!
                </p>
            </div>
        </div>
    </div>
</div>

<script>
const originalCanvas = document.getElementById('originalCanvas');
const originalCtx = originalCanvas.getContext('2d');
const compressedCanvas = document.getElementById('compressedCanvas');
const compressedCtx = compressedCanvas.getContext('2d');

let currentImage = 'sunset';
let k = 8;
let originalImageData = null;
let centroids = [];

const imageColors = {
    sunset: [
        [255, 120, 50], [255, 150, 80], [255, 180, 100], [255, 200, 150],
        [100, 50, 150], [150, 80, 200], [200, 150, 255], [50, 30, 100]
    ],
    forest: [
        [34, 139, 34], [0, 100, 0], [46, 125, 50], [76, 175, 80],
        [139, 69, 19], [101, 67, 33], [160, 82, 45], [205, 133, 63]
    ],
    ocean: [
        [0, 119, 190], [30, 144, 255], [135, 206, 250], [173, 216, 230],
        [0, 191, 255], [25, 25, 112], [70, 130, 180], [176, 224, 230]
    ],
    flower: [
        [255, 105, 180], [255, 20, 147], [255, 192, 203], [255, 182, 193],
        [34, 139, 34], [50, 205, 50], [255, 255, 0], [255, 215, 0]
    ]
};

function selectImage(imageName) {
    currentImage = imageName;
    document.querySelectorAll('.image-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    generateImage();
}

function generateImage() {
    const colors = imageColors[currentImage];

    // Draw original image with gradients and noise
    for (let y = 0; y < originalCanvas.height; y++) {
        for (let x = 0; x < originalCanvas.width; x++) {
            const colorIndex = Math.floor((x / originalCanvas.width) * colors.length);
            const color = colors[colorIndex];

            // Add gradient and noise
            const gradientFactor = y / originalCanvas.height;
            const noise = (Math.random() - 0.5) * 30;

            const r = Math.max(0, Math.min(255, color[0] * (1 - gradientFactor * 0.3) + noise));
            const g = Math.max(0, Math.min(255, color[1] * (1 - gradientFactor * 0.3) + noise));
            const b = Math.max(0, Math.min(255, color[2] * (1 - gradientFactor * 0.3) + noise));

            originalCtx.fillStyle = `rgb(${r},${g},${b})`;
            originalCtx.fillRect(x, y, 1, 1);
        }
    }

    originalImageData = originalCtx.getImageData(0, 0, originalCanvas.width, originalCanvas.height);

    // Count unique colors
    const uniqueColors = new Set();
    for (let i = 0; i < originalImageData.data.length; i += 4) {
        const color = `${originalImageData.data[i]},${originalImageData.data[i+1]},${originalImageData.data[i+2]}`;
        uniqueColors.add(color);
    }

    document.getElementById('originalColors').textContent = uniqueColors.size;

    // Clear compressed canvas
    compressedCtx.fillStyle = '#f0f0f0';
    compressedCtx.fillRect(0, 0, compressedCanvas.width, compressedCanvas.height);
    compressedCtx.fillStyle = '#999';
    compressedCtx.font = '16px Arial';
    compressedCtx.textAlign = 'center';
    compressedCtx.fillText('Click "Compress Colors" to see result', compressedCanvas.width/2, compressedCanvas.height/2);
}

function updateK() {
    k = parseInt(document.getElementById('kSlider').value);
    document.getElementById('kValue').textContent = k;
}

function compress() {
    if (!originalImageData) return;

    // Initialize random centroids
    centroids = [];
    for (let i = 0; i < k; i++) {
        centroids.push([
            Math.random() * 255,
            Math.random() * 255,
            Math.random() * 255
        ]);
    }

    // Run K-Means for 10 iterations
    for (let iter = 0; iter < 10; iter++) {
        const clusters = Array(k).fill(0).map(() => []);

        // Assign pixels to nearest centroid
        for (let i = 0; i < originalImageData.data.length; i += 4) {
            const r = originalImageData.data[i];
            const g = originalImageData.data[i + 1];
            const b = originalImageData.data[i + 2];

            let minDist = Infinity;
            let closestCentroid = 0;

            centroids.forEach((centroid, ci) => {
                const dist = Math.sqrt(
                    (r - centroid[0]) ** 2 +
                    (g - centroid[1]) ** 2 +
                    (b - centroid[2]) ** 2
                );

                if (dist < minDist) {
                    minDist = dist;
                    closestCentroid = ci;
                }
            });

            clusters[closestCentroid].push([r, g, b]);
        }

        // Update centroids
        centroids = clusters.map(cluster => {
            if (cluster.length === 0) return [Math.random() * 255, Math.random() * 255, Math.random() * 255];

            const sumR = cluster.reduce((sum, c) => sum + c[0], 0);
            const sumG = cluster.reduce((sum, c) => sum + c[1], 0);
            const sumB = cluster.reduce((sum, c) => sum + c[2], 0);

            return [
                sumR / cluster.length,
                sumG / cluster.length,
                sumB / cluster.length
            ];
        });
    }

    // Apply compressed colors
    const compressedData = compressedCtx.createImageData(compressedCanvas.width, compressedCanvas.height);

    for (let i = 0; i < originalImageData.data.length; i += 4) {
        const r = originalImageData.data[i];
        const g = originalImageData.data[i + 1];
        const b = originalImageData.data[i + 2];

        let minDist = Infinity;
        let closestCentroid = centroids[0];

        centroids.forEach(centroid => {
            const dist = Math.sqrt(
                (r - centroid[0]) ** 2 +
                (g - centroid[1]) ** 2 +
                (b - centroid[2]) ** 2
            );

            if (dist < minDist) {
                minDist = dist;
                closestCentroid = centroid;
            }
        });

        compressedData.data[i] = closestCentroid[0];
        compressedData.data[i + 1] = closestCentroid[1];
        compressedData.data[i + 2] = closestCentroid[2];
        compressedData.data[i + 3] = 255;
    }

    compressedCtx.putImageData(compressedData, 0, 0);

    updateStats();
    displayPalette();
}

function updateStats() {
    const originalColors = parseInt(document.getElementById('originalColors').textContent);
    const compressionRatio = ((originalColors - k) / originalColors * 100).toFixed(1);

    // Quality score (better with more colors)
    const qualityScore = Math.min(100, (k / 16) * 100);

    // Overall score balances compression and quality
    const score = Math.round((parseFloat(compressionRatio) + qualityScore) / 2);

    document.getElementById('compressedColors').textContent = k;
    document.getElementById('compression').textContent = compressionRatio + '%';
    document.getElementById('quality').textContent = qualityScore.toFixed(0) + '%';
    document.getElementById('scoreValue').textContent = score;
}

function displayPalette() {
    const palette = document.getElementById('paletteDisplay');
    let html = '';

    centroids.forEach((color, i) => {
        const r = Math.round(color[0]);
        const g = Math.round(color[1]);
        const b = Math.round(color[2]);
        const hex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;

        html += `
            <div style="text-align: center;">
                <div class="color-swatch" style="background: rgb(${r},${g},${b});" title="${hex}"></div>
                <div class="color-label">${hex}</div>
            </div>
        `;
    });

    palette.innerHTML = html;
}

function downloadPalette() {
    if (centroids.length === 0) {
        alert('Compress an image first!');
        return;
    }

    let paletteText = `Color Palette (${k} colors):\n\n`;
    centroids.forEach((color, i) => {
        const r = Math.round(color[0]);
        const g = Math.round(color[1]);
        const b = Math.round(color[2]);
        const hex = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        paletteText += `Color ${i + 1}: ${hex} - RGB(${r}, ${g}, ${b})\n`;
    });

    alert(paletteText);
}

function reset() {
    generateImage();
    document.getElementById('compressedColors').textContent = '0';
    document.getElementById('compression').textContent = '0%';
    document.getElementById('quality').textContent = '0%';
    document.getElementById('scoreValue').textContent = '0';
    document.getElementById('paletteDisplay').innerHTML = '<p style="color: #999; width: 100%; text-align: center;">Compress an image to see the color palette!</p>';
}

// Initialize
generateImage();
</script>
</body>
</html>
