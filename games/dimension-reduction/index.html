<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dimension Compressor - Dimension Reduction Game</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 0; }
.nav-header { background: #2d3748; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; justify-content: space-between; align-items: center; }
.nav-header a { color: #90cdf4; text-decoration: none; font-weight: 600; font-size: 1.1em; }
.nav-title { color: #fff; font-size: 1.2em; font-weight: 700; }
.container { max-width: 1400px; margin: 20px auto; background: #fff; border-radius: 15px; padding: 30px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
h1 { text-align: center; color: #2d3748; font-size: 2.5em; margin-bottom: 10px; }
.subtitle { text-align: center; color: #666; margin-bottom: 30px; font-size: 1.1em; }
.game-area { display: grid; grid-template-columns: 300px 1fr; gap: 30px; }
.sidebar { background: #f8f9fa; padding: 20px; border-radius: 10px; height: fit-content; position: sticky; top: 20px; }
.score-display { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 20px; border-radius: 10px; text-align: center; margin-bottom: 20px; }
.score-value { font-size: 3em; font-weight: bold; margin: 10px 0; }
.stats { margin: 15px 0; }
.stat-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e0e0; }
button { padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 1.05em; transition: all 0.3s; }
.btn-primary { background: #4CAF50; color: #fff; width: 100%; margin-top: 10px; }
.btn-primary:hover { background: #45a049; transform: scale(1.02); }
.btn-secondary { background: #2196F3; color: #fff; width: 100%; margin-top: 10px; }
.btn-secondary:hover { background: #1976d2; }
.instructions { background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; }
.instructions h4 { color: #1976d2; margin-bottom: 10px; }
.progress-bar { background: #e0e0e0; height: 8px; border-radius: 4px; margin: 20px 0; overflow: hidden; }
.progress-fill { background: linear-gradient(90deg, #667eea, #764ba2); height: 100%; transition: width 0.3s; }
.canvas-container { background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: center; }
canvas { border: 2px solid #ddd; border-radius: 8px; background: #fff; margin: 10px; }
.challenge-card { background: #fff9c4; padding: 20px; border-radius: 10px; margin: 20px 0; border-left: 4px solid #fbc02d; }
.challenge-card h3 { color: #f57c00; margin-bottom: 10px; }
.slider-container { margin: 15px 0; }
.slider-label { display: flex; justify-content: space-between; margin-bottom: 5px; color: #4a5568; font-weight: 600; }
input[type="range"] { width: 100%; height: 8px; border-radius: 5px; background: #ddd; outline: none; }
input[type="range"]::-webkit-slider-thumb { appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; }
input[type="range"]::-moz-range-thumb { width: 20px; height: 20px; border-radius: 50%; background: #667eea; cursor: pointer; border: none; }
.feedback-panel { background: #e8f5e9; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #4CAF50; display: none; }
.feedback-panel.show { display: block; animation: slideIn 0.3s; }
@keyframes slideIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
.metric-card { background: #fff; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 3px solid #667eea; }
.metric-card h4 { color: #667eea; margin-bottom: 8px; font-size: 1.1em; }
.metric-value { font-size: 2em; font-weight: bold; color: #2d3748; }
.dimension-viz { display: flex; gap: 10px; margin: 15px 0; align-items: center; justify-content: center; }
.dimension-box { background: #667eea; color: #fff; padding: 8px 12px; border-radius: 6px; font-weight: 600; font-size: 0.9em; }
.dimension-box.removed { background: #ccc; opacity: 0.5; text-decoration: line-through; }
</style>
</head>
<body>
<nav class="nav-header">
    <div class="nav-title">üìâ Dimension Compressor</div>
    <a href="../../index.html">‚Üê Back to Home</a>
</nav>
<div class="container">
    <h1>üìâ Dimension Compressor</h1>
    <p class="subtitle">Reduce dimensions while preserving the most information!</p>

    <div class="game-area">
        <div class="sidebar">
            <div class="score-display">
                <div>Total Score</div>
                <div class="score-value" id="totalScore">0</div>
                <div>Level: <span id="level">1</span></div>
            </div>

            <div class="stats">
                <div class="stat-row"><span>Challenges:</span><span id="challenges">0/6</span></div>
                <div class="stat-row"><span>Avg Variance:</span><span id="avgVariance">0%</span></div>
                <div class="stat-row"><span>Best Score:</span><span id="bestScore">0</span></div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressBar" style="width: 0%"></div>
            </div>

            <button class="btn-primary" onclick="applyReduction()">Apply Reduction</button>
            <button class="btn-secondary" onclick="showHint()">Show Hint</button>
            <button class="btn-secondary" onclick="nextChallenge()">Next Challenge ‚Üí</button>
            <button class="btn-secondary" onclick="resetGame()">New Game</button>

            <div class="instructions">
                <h4>How to Play:</h4>
                <p style="font-size: 0.9em; line-height: 1.6; color: #01579b;">
                    1. Examine the high-dimensional data<br>
                    2. Choose which dimensions to keep<br>
                    3. Try to preserve maximum variance<br>
                    4. Goal: Keep the most important info!<br><br>
                    <strong>Tip:</strong> Look for dimensions with the most spread!
                </p>
            </div>
        </div>

        <div class="game-content" id="gameContent">
            <!-- Content loads here -->
        </div>
    </div>
</div>

<script>
const challenges = [
    {
        title: "Introduction: 3D to 2D",
        dimensions: ['Height', 'Weight', 'Age'],
        targetDims: 2,
        description: "Reduce 3 dimensions to 2. Which dimension is least important?",
        hint: "Look at which dimension has the least variation in the data.",
        importance: [85, 90, 45] // Height, Weight, Age importance scores
    },
    {
        title: "Customer Data: 4D to 2D",
        dimensions: ['Income', 'Spending Score', 'Age', 'Account Age (days)'],
        targetDims: 2,
        description: "Reduce customer data from 4 dimensions to 2 for clustering.",
        hint: "Income and Spending Score likely contain the most information for customer segmentation.",
        importance: [90, 95, 60, 40]
    },
    {
        title: "Image Compression: 5D to 3D",
        dimensions: ['Red', 'Green', 'Blue', 'Brightness', 'Saturation'],
        targetDims: 3,
        description: "Compress color data while preserving visual quality.",
        hint: "RGB channels are fundamental, but Brightness and Saturation are derived from them.",
        importance: [95, 95, 95, 50, 55]
    },
    {
        title: "Sensor Data: 6D to 3D",
        dimensions: ['Temp', 'Humidity', 'Pressure', 'Wind Speed', 'Wind Dir', 'Dewpoint'],
        targetDims: 3,
        description: "Reduce weather sensor data for efficient storage.",
        hint: "Some weather metrics are highly correlated (dewpoint relates to temp & humidity).",
        importance: [90, 85, 80, 75, 40, 35]
    },
    {
        title: "Text Features: 8D to 4D",
        dimensions: ['Word Count', 'Unique Words', 'Avg Word Len', 'Sentence Count', 'Char Count', 'Stop Words', 'Punctuation', 'Capital Letters'],
        targetDims: 4,
        description: "Compress text features for document classification.",
        hint: "Character count and word count are highly correlated. Same with stop words and word count.",
        importance: [85, 90, 75, 80, 40, 45, 50, 35]
    },
    {
        title: "Final Challenge: 10D to 5D",
        dimensions: ['X1', 'X2', 'X3', 'X4', 'X5', 'X6', 'X7', 'X8', 'X9', 'X10'],
        targetDims: 5,
        description: "Reduce complex dataset while preserving 80%+ variance.",
        hint: "Try to identify which dimensions capture the most unique information.",
        importance: [92, 88, 85, 82, 78, 55, 52, 48, 40, 35]
    }
];

let currentChallenge = 0;
let score = 0;
let selectedDimensions = new Set();
let totalVariance = 0;

function init() {
    loadChallenge();
    updateStats();
}

function loadChallenge() {
    if (currentChallenge >= challenges.length) {
        showGameComplete();
        return;
    }

    const challenge = challenges[currentChallenge];
    const content = document.getElementById('gameContent');
    selectedDimensions.clear();

    content.innerHTML = `
        <div class="challenge-card">
            <h3>Challenge ${currentChallenge + 1}: ${challenge.title}</h3>
            <p style="line-height: 1.6; color: #4a5568; margin-top: 10px;">${challenge.description}</p>
            <p style="margin-top: 10px; font-weight: 600; color: #667eea;">
                Reduce from ${challenge.dimensions.length} dimensions to ${challenge.targetDims} dimensions
            </p>
        </div>

        <div class="canvas-container">
            <h3 style="color: #2d3748; margin-bottom: 15px;">Original Data Dimensions</h3>
            <canvas id="dimensionCanvas" width="900" height="400"></canvas>
            <p style="margin-top: 15px; color: #666; font-style: italic;">
                Each bar shows the variance (spread) of data in that dimension
            </p>
        </div>

        <div style="background: #fff; padding: 25px; border-radius: 10px; margin: 20px 0;">
            <h3 style="color: #2d3748; margin-bottom: 20px;">Select ${challenge.targetDims} Dimensions to Keep:</h3>
            <div id="dimensionCheckboxes"></div>
        </div>

        <div class="feedback-panel" id="feedbackPanel"></div>
    `;

    drawDimensionChart();
    createCheckboxes();
    updateProgress();
}

function drawDimensionChart() {
    const challenge = challenges[currentChallenge];
    const canvas = document.getElementById('dimensionCanvas');
    const ctx = canvas.getContext('2d');

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const barWidth = 80;
    const spacing = 10;
    const maxHeight = 300;
    const startX = (canvas.width - (challenge.dimensions.length * (barWidth + spacing))) / 2;
    const startY = 50;

    // Draw bars
    challenge.dimensions.forEach((dim, i) => {
        const importance = challenge.importance[i];
        const barHeight = (importance / 100) * maxHeight;
        const x = startX + i * (barWidth + spacing);
        const y = startY + maxHeight - barHeight;

        // Bar
        const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
        gradient.addColorStop(0, '#667eea');
        gradient.addColorStop(1, '#764ba2');
        ctx.fillStyle = gradient;
        ctx.fillRect(x, y, barWidth, barHeight);

        // Border
        ctx.strokeStyle = '#2d3748';
        ctx.lineWidth = 2;
        ctx.strokeRect(x, y, barWidth, barHeight);

        // Label
        ctx.fillStyle = '#2d3748';
        ctx.font = 'bold 12px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(dim, x + barWidth/2, startY + maxHeight + 20);

        // Variance percentage
        ctx.fillStyle = '#667eea';
        ctx.font = 'bold 14px Arial';
        ctx.fillText(`${importance}%`, x + barWidth/2, y - 10);
    });
}

function createCheckboxes() {
    const challenge = challenges[currentChallenge];
    const container = document.getElementById('dimensionCheckboxes');

    container.innerHTML = challenge.dimensions.map((dim, i) => `
        <label style="display: flex; align-items: center; padding: 12px; margin: 8px 0; background: #f8f9fa; border-radius: 8px; cursor: pointer; transition: all 0.3s;" id="dimLabel${i}">
            <input type="checkbox" id="dim${i}" onchange="toggleDimension(${i})" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
            <span style="font-weight: 600; color: #2d3748; flex: 1;">${dim}</span>
            <span style="color: #667eea; font-weight: 600;">${challenge.importance[i]}% variance</span>
        </label>
    `).join('');
}

function toggleDimension(index) {
    const challenge = challenges[currentChallenge];
    const checkbox = document.getElementById(`dim${index}`);
    const label = document.getElementById(`dimLabel${index}`);

    if (checkbox.checked) {
        if (selectedDimensions.size >= challenge.targetDims) {
            checkbox.checked = false;
            alert(`You can only select ${challenge.targetDims} dimensions!`);
            return;
        }
        selectedDimensions.add(index);
        label.style.background = 'linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%)';
        label.style.borderLeft = '4px solid #4CAF50';
    } else {
        selectedDimensions.delete(index);
        label.style.background = '#f8f9fa';
        label.style.borderLeft = 'none';
    }
}

function applyReduction() {
    const challenge = challenges[currentChallenge];

    if (selectedDimensions.size !== challenge.targetDims) {
        alert(`Please select exactly ${challenge.targetDims} dimensions!`);
        return;
    }

    // Calculate preserved variance
    let preservedVariance = 0;
    let maxPossibleVariance = 0;

    challenge.importance.forEach((imp, i) => {
        maxPossibleVariance += imp;
        if (selectedDimensions.has(i)) {
            preservedVariance += imp;
        }
    });

    // Get top N dimensions
    const sortedImportance = challenge.importance
        .map((imp, i) => ({imp, i}))
        .sort((a, b) => b.imp - a.imp)
        .slice(0, challenge.targetDims);

    const optimalVariance = sortedImportance.reduce((sum, d) => sum + d.imp, 0);

    const percentage = Math.round((preservedVariance / maxPossibleVariance) * 100);
    const optimalPercentage = Math.round((optimalVariance / maxPossibleVariance) * 100);

    // Calculate points
    const efficiency = (preservedVariance / optimalVariance) * 100;
    let points = 0;

    if (efficiency >= 95) {
        points = 100;
    } else if (efficiency >= 85) {
        points = 80;
    } else if (efficiency >= 75) {
        points = 60;
    } else if (efficiency >= 60) {
        points = 40;
    } else {
        points = 20;
    }

    score += points;
    totalVariance += percentage;

    showFeedback(percentage, optimalPercentage, points, sortedImportance);
    updateStats();
}

function showFeedback(percentage, optimal, points, optimalDims) {
    const challenge = challenges[currentChallenge];
    const panel = document.getElementById('feedbackPanel');

    let message = '';
    if (percentage >= optimal - 5) {
        message = 'üéâ Perfect! You found the optimal dimensions!';
    } else if (percentage >= optimal - 10) {
        message = '‚ú® Great job! Very close to optimal!';
    } else if (percentage >= optimal - 20) {
        message = 'üëç Good work! You preserved most of the information.';
    } else {
        message = 'üí™ Keep learning! Try to identify dimensions with highest variance.';
    }

    const optimalDimNames = optimalDims.map(d => challenge.dimensions[d.i]).join(', ');

    panel.innerHTML = `
        <h4 style="color: #2e7d32; margin-bottom: 15px;">${message}</h4>
        <div style="line-height: 1.8;">
            <p><strong>Your Selection:</strong> Preserved ${percentage}% of total variance</p>
            <p><strong>Optimal Selection:</strong> ${optimal}% (${optimalDimNames})</p>
            <p style="font-weight: bold; margin-top: 15px; font-size: 1.2em; color: #667eea;">Points Earned: +${points}</p>
        </div>
        <p style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #4CAF50; color: #4a5568;">
            <strong>Why it matters:</strong> In real ML, keeping dimensions with high variance preserves the most information
            while reducing computational cost. This is the core principle of PCA (Principal Component Analysis)!
        </p>
    `;

    panel.classList.add('show');
}

function showHint() {
    const challenge = challenges[currentChallenge];
    alert('üí° Hint: ' + challenge.hint);
}

function nextChallenge() {
    currentChallenge++;
    document.getElementById('level').textContent = currentChallenge + 1;

    if (currentChallenge >= challenges.length) {
        showGameComplete();
    } else {
        loadChallenge();
    }
}

function showGameComplete() {
    const content = document.getElementById('gameContent');
    const avgVariance = Math.round(totalVariance / challenges.length);

    content.innerHTML = `
        <div style="text-align: center; padding: 40px; background: #fff; border-radius: 10px;">
            <h2 style="color: #4CAF50; font-size: 2.5em; margin-bottom: 20px;">üéâ All Challenges Complete!</h2>

            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 30px; border-radius: 15px; margin: 30px 0;">
                <div style="font-size: 4em; font-weight: bold; margin-bottom: 10px;">${score}</div>
                <div style="font-size: 1.5em;">Total Points</div>
                <div style="margin-top: 20px; font-size: 1.2em;">
                    Average Variance Preserved: ${avgVariance}%
                </div>
            </div>

            <div style="background: #e3f2fd; padding: 25px; border-radius: 10px; margin: 20px 0; text-align: left;">
                <h3 style="color: #1976d2; margin-bottom: 15px;">üéì What You've Learned:</h3>
                <ul style="line-height: 1.8; margin-left: 20px; color: #4a5568;">
                    <li>Dimension reduction preserves the most important information while reducing complexity</li>
                    <li>High variance dimensions contain more useful information</li>
                    <li>PCA (Principal Component Analysis) automatically finds optimal dimensions</li>
                    <li>Real applications: image compression, data visualization, faster ML training</li>
                    <li>Trade-off: compression vs. information preservation</li>
                </ul>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                <p style="line-height: 1.8; color: #4a5568;">
                    <strong>Real-world example:</strong> Netflix uses dimension reduction to compress movie ratings
                    from thousands of features down to ~50 dimensions, making recommendations faster while keeping
                    accuracy high. This same technique powers facial recognition, document search, and more!
                </p>
            </div>

            <button class="btn-primary" style="max-width: 300px; margin: 20px auto;" onclick="resetGame()">Play Again</button>
        </div>
    `;
}

function resetGame() {
    currentChallenge = 0;
    score = 0;
    totalVariance = 0;
    selectedDimensions.clear();
    document.getElementById('level').textContent = '1';
    loadChallenge();
    updateStats();
}

function updateProgress() {
    const progress = (currentChallenge / challenges.length) * 100;
    document.getElementById('progressBar').style.width = progress + '%';
    document.getElementById('challenges').textContent = `${currentChallenge}/${challenges.length}`;
}

function updateStats() {
    document.getElementById('totalScore').textContent = score;

    const avgVariance = currentChallenge > 0 ? Math.round(totalVariance / currentChallenge) : 0;
    document.getElementById('avgVariance').textContent = avgVariance + '%';

    const bestScore = localStorage.getItem('dimensionReductionBest') || 0;
    if (score > bestScore) {
        localStorage.setItem('dimensionReductionBest', score);
        document.getElementById('bestScore').textContent = score;
    } else {
        document.getElementById('bestScore').textContent = bestScore;
    }
}

// Initialize
init();
</script>
</body>
</html>
