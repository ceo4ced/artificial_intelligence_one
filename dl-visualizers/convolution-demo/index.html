<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Convolution Operation Visualizer - Deep Learning Tool</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 0;
}

.nav-header {
    background: #2d3748;
    padding: 15px 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-header a {
    color: #90cdf4;
    text-decoration: none;
    font-weight: 600;
    font-size: 1.1em;
    transition: color 0.3s;
    margin-left: 15px;
}

.nav-header a:hover {
    color: #63b3ed;
}

.nav-title {
    color: #fff;
    font-size: 1.2em;
    font-weight: 700;
}

.nav-links {
    display: flex;
    gap: 10px;
}

.page-wrapper {
    padding: 20px;
}

.container {
    max-width: 1600px;
    margin: 0 auto;
    background: #fff;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
}

h1 {
    text-align: center;
    color: #2d3748;
    margin-bottom: 10px;
    font-size: 2.5em;
}

.subtitle {
    text-align: center;
    color: #4a5568;
    margin-bottom: 30px;
    font-size: 1.1em;
}

.info-section {
    background: #e8f5e9;
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 25px;
    border-left: 5px solid #4CAF50;
}

.info-section h3 {
    color: #2e7d32;
    margin-bottom: 10px;
}

.info-section p {
    color: #1b5e20;
    line-height: 1.6;
    margin-bottom: 8px;
}

.info-section ul {
    list-style-position: inside;
    color: #1b5e20;
    line-height: 1.8;
}

.main-content {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.sidebar {
    background: #f8f9fa;
    padding: 20px;
    border-radius: 10px;
    height: fit-content;
}

.sidebar h3 {
    color: #2d3748;
    margin-bottom: 15px;
    font-size: 1.3em;
}

.control-section {
    margin-bottom: 20px;
}

.control-section label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #4a5568;
}

button {
    width: 100%;
    padding: 12px;
    font-size: 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    margin-bottom: 10px;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.btn-primary {
    background: #4CAF50;
    color: #fff;
}

.btn-primary:hover {
    background: #45a049;
}

.btn-secondary {
    background: #2196F3;
    color: #fff;
}

.btn-secondary:hover {
    background: #0b7dda;
}

.btn-danger {
    background: #f44336;
    color: #fff;
}

.btn-danger:hover {
    background: #da190b;
}

.btn-warning {
    background: #ff9800;
    color: #fff;
}

.btn-warning:hover {
    background: #e68900;
}

.slider-control {
    width: 100%;
    margin-bottom: 10px;
}

.slider-value {
    text-align: center;
    font-weight: 600;
    color: #667eea;
    margin-bottom: 10px;
    font-size: 1.2em;
}

select {
    width: 100%;
    padding: 10px;
    border: 2px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    margin-bottom: 10px;
    font-weight: 600;
}

.canvas-container {
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    padding: 20px;
}

.canvas-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.canvas-box {
    text-align: center;
}

.canvas-box h4 {
    color: #2d3748;
    margin-bottom: 10px;
    font-size: 1.1em;
}

canvas {
    display: block;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    background: #fafafa;
    margin: 0 auto;
}

.filter-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 15px;
}

.filter-buttons button {
    font-size: 12px;
    padding: 8px;
}

.status-indicator {
    background: #e3f2fd;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
    font-size: 0.9em;
    color: #1565c0;
    font-weight: 600;
    text-align: center;
}

.filter-display {
    background: #fff3cd;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    text-align: center;
}

.filter-grid {
    display: inline-grid;
    grid-template-columns: repeat(3, 30px);
    gap: 3px;
    margin-top: 10px;
}

.filter-cell {
    width: 30px;
    height: 30px;
    background: #fff;
    border: 1px solid #666;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    font-weight: bold;
}

@media (max-width: 1400px) {
    .main-content {
        grid-template-columns: 1fr;
    }

    .canvas-row {
        grid-template-columns: 1fr;
    }
}
</style>
</head>
<body>
<nav class="nav-header">
    <div class="nav-title">Convolution Operation Visualizer</div>
    <div class="nav-links">
        <a href="../../deep-learning.html">Deep Learning Hub</a>
        <a href="../../index.html">Home</a>
    </div>
</nav>

<div class="page-wrapper">
    <div class="container">
        <h1>Convolution Operation Visualizer</h1>
        <p class="subtitle">See how CNNs extract features from images using filters!</p>

        <div class="info-section">
            <h3>What is a Convolution Operation?</h3>
            <p>
                Convolution is the core operation in Convolutional Neural Networks (CNNs). A small filter (kernel)
                slides across an image, performing element-wise multiplication and summation to create a feature map
                that highlights specific patterns.
            </p>
            <p><strong>Key concepts:</strong></p>
            <ul>
                <li><strong>Filter/Kernel:</strong> A small matrix that detects specific features (edges, textures)</li>
                <li><strong>Stride:</strong> How many pixels the filter moves at each step</li>
                <li><strong>Feature Map:</strong> The output that shows where features were detected</li>
                <li><strong>Edge Detection:</strong> Filters that highlight boundaries in images</li>
                <li><strong>Pooling:</strong> Reduces size while keeping important features</li>
            </ul>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <h3>Controls</h3>

                <div class="status-indicator" id="statusIndicator">
                    Ready - Select a filter
                </div>

                <div class="control-section">
                    <label>Select Filter:</label>
                    <select id="filterSelect" onchange="changeFilter()">
                        <option value="edge_vertical">Vertical Edge Detector</option>
                        <option value="edge_horizontal">Horizontal Edge Detector</option>
                        <option value="edge_all">All Edge Detector</option>
                        <option value="sharpen">Sharpen</option>
                        <option value="blur">Blur (Average)</option>
                        <option value="emboss">Emboss</option>
                    </select>
                </div>

                <div class="filter-display">
                    <strong>Current Filter:</strong>
                    <div class="filter-grid" id="filterDisplay"></div>
                </div>

                <div class="control-section">
                    <label>Stride: <span id="strideValue">1</span></label>
                    <input type="range" class="slider-control" id="strideSlider"
                           min="1" max="3" step="1" value="1"
                           oninput="updateStride()">
                </div>

                <div class="control-section">
                    <label>Animation Speed:</label>
                    <div class="slider-value" id="speedValue">Medium</div>
                    <input type="range" class="slider-control" id="speedSlider"
                           min="1" max="3" step="1" value="2"
                           oninput="updateSpeed()">
                </div>

                <button class="btn-primary" onclick="startConvolution()">Start Convolution</button>
                <button class="btn-warning" onclick="pauseConvolution()">Pause</button>
                <button class="btn-danger" onclick="resetConvolution()">Reset</button>

                <div class="control-section">
                    <label>Sample Images:</label>
                    <div class="filter-buttons">
                        <button class="btn-secondary" onclick="loadImage('shapes')">Shapes</button>
                        <button class="btn-secondary" onclick="loadImage('letter')">Letter X</button>
                        <button class="btn-secondary" onclick="loadImage('grid')">Grid</button>
                        <button class="btn-secondary" onclick="loadImage('checker')">Checker</button>
                    </div>
                </div>
            </div>

            <div class="canvas-container">
                <div class="canvas-row">
                    <div class="canvas-box">
                        <h4>Input Image</h4>
                        <canvas id="inputCanvas" width="300" height="300"></canvas>
                    </div>
                    <div class="canvas-box">
                        <h4>Convolution Process</h4>
                        <canvas id="processCanvas" width="300" height="300"></canvas>
                        <p id="processInfo" style="margin-top: 10px; color: #667eea; font-weight: 600;">
                            Click "Start Convolution" to begin
                        </p>
                    </div>
                    <div class="canvas-box">
                        <h4>Feature Map (Output)</h4>
                        <canvas id="outputCanvas" width="300" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const inputCanvas = document.getElementById('inputCanvas');
const processCanvas = document.getElementById('processCanvas');
const outputCanvas = document.getElementById('outputCanvas');

const inputCtx = inputCanvas.getContext('2d');
const processCtx = processCanvas.getContext('2d');
const outputCtx = outputCanvas.getContext('2d');

const GRID_SIZE = 15;
const CELL_SIZE = 20;

let inputImage = [];
let currentFilter = [];
let filterName = 'edge_vertical';
let stride = 1;
let animationSpeed = 100;
let isAnimating = false;
let animationInterval = null;
let currentRow = 0;
let currentCol = 0;
let featureMap = [];

const filters = {
    edge_vertical: [
        [-1, 0, 1],
        [-2, 0, 2],
        [-1, 0, 1]
    ],
    edge_horizontal: [
        [-1, -2, -1],
        [0, 0, 0],
        [1, 2, 1]
    ],
    edge_all: [
        [-1, -1, -1],
        [-1, 8, -1],
        [-1, -1, -1]
    ],
    sharpen: [
        [0, -1, 0],
        [-1, 5, -1],
        [0, -1, 0]
    ],
    blur: [
        [1/9, 1/9, 1/9],
        [1/9, 1/9, 1/9],
        [1/9, 1/9, 1/9]
    ],
    emboss: [
        [-2, -1, 0],
        [-1, 1, 1],
        [0, 1, 2]
    ]
};

function initializeImage() {
    inputImage = [];
    for (let i = 0; i < GRID_SIZE; i++) {
        inputImage[i] = [];
        for (let j = 0; j < GRID_SIZE; j++) {
            inputImage[i][j] = 0;
        }
    }
}

function loadImage(type) {
    initializeImage();

    switch(type) {
        case 'shapes':
            // Draw a square and circle
            for (let i = 2; i < 6; i++) {
                for (let j = 2; j < 6; j++) {
                    inputImage[i][j] = 255;
                }
            }
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    const dx = i - 10;
                    const dy = j - 10;
                    if (dx*dx + dy*dy < 12) {
                        inputImage[i][j] = 255;
                    }
                }
            }
            break;

        case 'letter':
            // Draw an X
            for (let i = 0; i < GRID_SIZE; i++) {
                inputImage[i][i] = 255;
                inputImage[i][GRID_SIZE - 1 - i] = 255;
            }
            break;

        case 'grid':
            // Vertical and horizontal lines
            for (let i = 0; i < GRID_SIZE; i++) {
                inputImage[5][i] = 255;
                inputImage[10][i] = 255;
                inputImage[i][5] = 255;
                inputImage[i][10] = 255;
            }
            break;

        case 'checker':
            // Checkerboard pattern
            for (let i = 0; i < GRID_SIZE; i++) {
                for (let j = 0; j < GRID_SIZE; j++) {
                    if ((Math.floor(i/3) + Math.floor(j/3)) % 2 === 0) {
                        inputImage[i][j] = 255;
                    }
                }
            }
            break;
    }

    drawInputImage();
    resetConvolution();
}

function drawInputImage() {
    inputCtx.clearRect(0, 0, inputCanvas.width, inputCanvas.height);

    for (let i = 0; i < GRID_SIZE; i++) {
        for (let j = 0; j < GRID_SIZE; j++) {
            const value = inputImage[i][j];
            inputCtx.fillStyle = `rgb(${value}, ${value}, ${value})`;
            inputCtx.fillRect(j * CELL_SIZE, i * CELL_SIZE, CELL_SIZE, CELL_SIZE);

            inputCtx.strokeStyle = '#ddd';
            inputCtx.lineWidth = 1;
            inputCtx.strokeRect(j * CELL_SIZE, i * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        }
    }
}

function changeFilter() {
    filterName = document.getElementById('filterSelect').value;
    currentFilter = filters[filterName];
    displayFilter();
    resetConvolution();
}

function displayFilter() {
    const filterDisplay = document.getElementById('filterDisplay');
    filterDisplay.innerHTML = '';

    for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
            const cell = document.createElement('div');
            cell.className = 'filter-cell';
            const value = currentFilter[i][j];
            cell.textContent = typeof value === 'number' ? value.toFixed(1) : value;
            cell.style.background = value > 0 ? '#c8e6c9' : value < 0 ? '#ffcdd2' : '#fff';
            filterDisplay.appendChild(cell);
        }
    }
}

function updateStride() {
    stride = parseInt(document.getElementById('strideSlider').value);
    document.getElementById('strideValue').textContent = stride;
    resetConvolution();
}

function updateSpeed() {
    const speed = parseInt(document.getElementById('speedSlider').value);
    const speeds = { 1: 'Slow', 2: 'Medium', 3: 'Fast' };
    const delays = { 1: 200, 2: 100, 3: 50 };

    document.getElementById('speedValue').textContent = speeds[speed];
    animationSpeed = delays[speed];
}

function applyConvolution(row, col) {
    let sum = 0;

    for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
            const imgRow = row + i;
            const imgCol = col + j;

            if (imgRow < GRID_SIZE && imgCol < GRID_SIZE) {
                sum += inputImage[imgRow][imgCol] * currentFilter[i][j];
            }
        }
    }

    // Normalize and clamp
    return Math.max(0, Math.min(255, sum));
}

function drawProcessStep() {
    processCtx.clearRect(0, 0, processCanvas.width, processCanvas.height);

    // Draw input image faded
    processCtx.globalAlpha = 0.3;
    for (let i = 0; i < GRID_SIZE; i++) {
        for (let j = 0; j < GRID_SIZE; j++) {
            const value = inputImage[i][j];
            processCtx.fillStyle = `rgb(${value}, ${value}, ${value})`;
            processCtx.fillRect(j * CELL_SIZE, i * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        }
    }

    processCtx.globalAlpha = 1;

    // Highlight current filter position
    processCtx.strokeStyle = '#ff9800';
    processCtx.lineWidth = 3;
    processCtx.strokeRect(currentCol * CELL_SIZE, currentRow * CELL_SIZE, 3 * CELL_SIZE, 3 * CELL_SIZE);

    // Show filter values
    for (let i = 0; i < 3; i++) {
        for (let j = 0; j < 3; j++) {
            const imgRow = currentRow + i;
            const imgCol = currentCol + j;

            if (imgRow < GRID_SIZE && imgCol < GRID_SIZE) {
                const value = inputImage[imgRow][imgCol];
                const filterVal = currentFilter[i][j];

                processCtx.fillStyle = 'rgba(102, 126, 234, 0.7)';
                processCtx.fillRect(imgCol * CELL_SIZE, imgRow * CELL_SIZE, CELL_SIZE, CELL_SIZE);

                processCtx.strokeStyle = '#2d3748';
                processCtx.lineWidth = 1;
                processCtx.strokeRect(imgCol * CELL_SIZE, imgRow * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }
        }
    }

    // Show computation
    const result = applyConvolution(currentRow, currentCol);
    document.getElementById('processInfo').textContent =
        `Position (${currentRow}, ${currentCol}) â†’ Output: ${result.toFixed(0)}`;
}

function drawFeatureMap() {
    outputCtx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);

    const mapSize = Math.floor((GRID_SIZE - 2) / stride);

    for (let i = 0; i < featureMap.length; i++) {
        for (let j = 0; j < featureMap[i].length; j++) {
            const value = featureMap[i][j];
            outputCtx.fillStyle = `rgb(${value}, ${value}, ${value})`;
            outputCtx.fillRect(j * CELL_SIZE, i * CELL_SIZE, CELL_SIZE, CELL_SIZE);

            outputCtx.strokeStyle = '#ddd';
            outputCtx.lineWidth = 1;
            outputCtx.strokeRect(j * CELL_SIZE, i * CELL_SIZE, CELL_SIZE, CELL_SIZE);
        }
    }
}

function startConvolution() {
    if (isAnimating) return;

    if (inputImage.every(row => row.every(val => val === 0))) {
        alert('Please load a sample image first!');
        return;
    }

    isAnimating = true;
    currentRow = 0;
    currentCol = 0;

    const maxSize = Math.floor((GRID_SIZE - 2) / stride);
    featureMap = Array(maxSize).fill(0).map(() => Array(maxSize).fill(0));

    document.getElementById('statusIndicator').textContent = 'Convolving...';
    document.getElementById('statusIndicator').style.background = '#d4edda';
    document.getElementById('statusIndicator').style.color = '#155724';

    animationInterval = setInterval(() => {
        const mapRow = Math.floor(currentRow / stride);
        const mapCol = Math.floor(currentCol / stride);

        featureMap[mapRow][mapCol] = applyConvolution(currentRow, currentCol);

        drawProcessStep();
        drawFeatureMap();

        currentCol += stride;
        if (currentCol > GRID_SIZE - 3) {
            currentCol = 0;
            currentRow += stride;
        }

        if (currentRow > GRID_SIZE - 3) {
            pauseConvolution();
            document.getElementById('statusIndicator').textContent = 'Convolution Complete!';
            document.getElementById('statusIndicator').style.background = '#d4edda';
            document.getElementById('processInfo').textContent = 'Convolution complete - Feature map generated!';
        }
    }, animationSpeed);
}

function pauseConvolution() {
    isAnimating = false;
    if (animationInterval) {
        clearInterval(animationInterval);
        animationInterval = null;
    }

    document.getElementById('statusIndicator').textContent = 'Paused';
    document.getElementById('statusIndicator').style.background = '#fff3cd';
    document.getElementById('statusIndicator').style.color = '#856404';
}

function resetConvolution() {
    pauseConvolution();

    currentRow = 0;
    currentCol = 0;

    const maxSize = Math.floor((GRID_SIZE - 2) / stride);
    featureMap = Array(maxSize).fill(0).map(() => Array(maxSize).fill(0));

    processCtx.clearRect(0, 0, processCanvas.width, processCanvas.height);
    outputCtx.clearRect(0, 0, outputCanvas.width, outputCanvas.height);

    document.getElementById('statusIndicator').textContent = 'Ready - Select a filter';
    document.getElementById('statusIndicator').style.background = '#e3f2fd';
    document.getElementById('statusIndicator').style.color = '#1565c0';

    document.getElementById('processInfo').textContent = 'Click "Start Convolution" to begin';
}

// Initialize
initializeImage();
loadImage('shapes');
changeFilter();
</script>
</body>
</html>
